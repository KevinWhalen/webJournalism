<!doctype>
<html>
<head>
<meta charset="utf-8">
<title>Just the category legend/key</title>
</head>

<body>
<div id="container" style="margin-left:4%;">
</div>

<script type="text/javascript" src="scripts/jQuery/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="scripts/d3/d3.v3.min.js"></script>
<script type="text/javascript" src="scripts/colorbrewer.js"></script>

<script type="text/javascript" src="data/webSiteRatings.js">
// researched data as a global JSON object</script>

<script type="text/javascript" src="scripts/toggleVisibility.js"></script>
<script type="text/javascript" src="scripts/initiateSocialGraphic.js">
// initiate the social media ratings graphic</script>
<script type="text/javascript" src="scripts/animateSocialGraphic.js">
// mouse over animations</script>
<script type="text/javascript" src="scripts/reverseSocialGraphic.js">
// mouse out return original state animations</script>
<script type="text/javascript" src="scripts/resizeSocialGraphic.js"></script>
<script type="text/javascript" src="scripts/readyFunc.js"></script>

<script type="text/javascript">
    var w = 660;
    var h = w * 0.45;
    // variables. coordinates origin is upper left.
    var frameWidth = w;
    var frameHeight = h;
    var barOffsetX = frameWidth * 0.06; // was 6%
    var barOffsetY = frameHeight * 0.49;
    var barLength = frameWidth * 0.92; // was 88% when w was 77%
    var barThickness = frameHeight * 0.015;
    var legendWidth = frameWidth * 0.05;

    // icon diameter for width/height and such
    var iconDiameter = frameHeight * 0.12; // was 15%

    // global data object
    var titleData = window.researchData;
    // a count of the number of objects in the array.
    var titleCount = Object.keys(titleData).length;

//---------------------------------------------------------------------------
    // container
    d3.select("body").select("#container").append("div")
        .attr("id", "legendRegion")
        .attr("width", frameWidth)
        .attr("height", frameHeight)
        .style("z-index", 0)
        .style("background-image", "url('images/subtle_white_feathers.png')")
        .style("display", "inline-block")
//      .style("border-style", "solid")
        .style("margin-left", "auto")
        .style("margin-right", "auto");

    // graphic
    var svg = d3.select("body").select("#legendRegion").append("svg")
        .attr("xmlns", "http://www.w3.org/2000/svg")
        .attr("xlink", "http://www.w3.org/1999/xlink")
        .attr("id", "legendSVG")
        .attr("width", frameWidth)
        .attr("height", frameHeight)
        .attr("stroke", "black")
        .attr("stroke-width", 0)
        // transition graphic
        .on("mouseover", function(d,i){
            animateGraphic(barLength, legendWidth, frameHeight, titleCount, iconDiameter);
        })
        // transition back to starting state
        .on("mouseout", function(d,i){
//          reverseGraphic((barOffsetX - (iconDiameter / 2)), (barOffsetY - (iconDiameter / 2)));
        })
        .on("click", function(d,i){
            animateGraphic(barLength, legendWidth, frameHeight, titleCount, iconDiameter);
        })
        .style("z-index", 10)
        .style("margin-left", "auto")
        .style("margin-right", "auto")
      .style("border-style", "solid")
        .style("border-style", "none")
        .style("border-width", 0.2 + "em")
        .style("border-color", "black");

//---------------------------------------------------------------------------
// Category Shapes
    // helper function for setting X-Axis position of categories.
    function categoryPosition(idx)
    {
/*
		var segment = barLength + (barLength * 0.07);
		var offsetX = legendWidth + iconDiameter;//(iconDiameter / 2);

		var exposeRight = segment * 0.10;
		var reducedSegment = (segment - (exposeRight * 2));
		var portion = ((reducedSegment / (titleCount - 1)) * idx);
		return offsetX + portion + (sIdx * (iconDiameter * 0.50));
*/
		return 20;
    }

	svg.append("g").attr("id", "g_legend");

	var categories = titleData[0]["category"];
	for (var i in categories){
		console.log(i+" : "+categories[i]["file"]);
		d3.xml(categories[i]["file"], "image/svg+xml", function(error,xml){
			document.getElementById("g_legend").appendChild(xml.documentElement);
			svg.select("#svg_" + categories[i]["shape"])
				.attr("id", "legend_" + categories[i]["shape"])
				.attr("width", (iconDiameter * 0.60))
				.attr("height", (iconDiameter * 0.60))
//				.attr("x", categoryPosition(i,0) - (iconDiameter * 0.10))
//				.attr("y", (barOffsetY - (iconDiameter / 2)))
				.attr("x", 300)
				.attr("y", (i * iconDiameter * 0.50) + 10)
				.style("z-index", 6);

			svg.select("#img_" + categories[i]["shape"])
				.attr("id", "img_" + "legend_" + categories[i]["shape"])
				.attr("xlink:title", "Click the category icons for more information.")
				.attr("width", (iconDiameter * 0.60))
				.attr("height", (iconDiameter * 0.60))
				.on("click", function(){
					alert("Click the category icons in the graphic \
					below to explore the research based rating information.");
				});
		});
	}

/*
  titleData.forEach(function(d,i,a){
    d["category"].forEach(function(s, sID){
      d3.xml(s["file"], "image/svg+xml", function(error,xml){
        var categoryGroup = svg.select("#g_" + d["name"]).append("rect")
            .attr("id", "bar_" + d["name"] + "_" + s["shape"])
            .attr("width", (iconDiameter * 0.40))
            .attr("height", 0)
            .attr("x", categoryPosition(i, sID))
            .attr("y", centerY)
            .style("z-index", 6)
            .style("display", "none")
            .attr("title", s["rating"])
            .attr("fill", "url(#gradient)");
        svg.select("#svg_" + s["shape"])
            // set new id
            .attr("id", d["name"] + "_" + s["shape"])
            .attr("width", (iconDiameter * 0.60))
            .attr("height", (iconDiameter * 0.60))
            // give title icon starting "x" location and hide initially
//position minus half the difference between bar width and category icon size
            .attr("x", categoryPosition(i, sID) - (iconDiameter * 0.10))
            .attr("y", (barOffsetY - (iconDiameter / 2)))
            .style("z-index", 6)
            .style("display", "none");

        svg.select("#img_" + s["shape"])
            .attr("id", "img_" + d["name"] + "_" + s["shape"])
            .attr("xlink:title", s["rating"])
            .attr("width", (iconDiameter * 0.60))
            .attr("height", (iconDiameter * 0.60))
            .on("click", function(){
                alert(s['title'] + " Rating: " + s['rating'] + "\n" + s['text']);
            });
      });
    });
  });
*/
</script>
</body>
</html>

